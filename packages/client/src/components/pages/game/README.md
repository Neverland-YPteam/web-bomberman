## Канвас

Используем два полотна:
- статический - для фона информационной панели, колонн, стен и травы
- динамический - для обновляемых текстур (герой, бомба, враги и т.д.)

Картинка состоит из двух основных секций:
- информационная панель
- игровое поле


## Информационная панель

- Текстом отображаются набранные очки и количество жизней
- В процессе игры очки и жизни обновляются через методы класса


## Игровое поле

- Состоит из квадратных ячеек
- Размер ячеек 48px, это число имеет много кратных значений, подходящих для игры
- Ширина и высота поля могут быть любыми, но количество ячеек по X и Y должно быть нечетным, иначе текстуры не получится правильно расставить
- Если поле будет выходить за пределы канваса, необходимо добавить управление камерой при движении персонажа, но это повышает сложность разработки


## Текстуры

| Название | Описание |
|:---|:---|
| `COLUMN` | Колонна. Не может быть уничтожена. Отрисовывается по периметру поля и через одну ячейку на самом поле. Блокирует путь `HERO` и `ENEMY` |
| `WALL` | Разрушаемая стена. Может быть уничтожена `BLAST`. Блокирует путь `HERO` и `ENEMY`, если у них нет умения проходить сквозь стены |
| `GRASS` | Трава, где `HERO` и `ENEMY` могут свободно перемещаться. Может перекрываться другими текстурами. Если перекрыта полностью непрозрачной текстурой (например, `WALL` или `EXIT`), не рендерится. Если перекрыта текстурой с прозрачностью (например, `ENEMY`), рендерится слоем ниже |
| `HERO` | См. «Герой» |
| `BOMB` | Бомба. Взрывается по таймеру, детонатором или при контакте с `BLAST` |
| `BLAST` | Огонь. Может иметь разную длину, в зависимости от умения `HERO`
| `ENEMY` | Враги (`ENEMY_BALLOON`, `ENEMY_GHOST` и т.д.). Имеют различные характеристики, см. «Враги» |
| `BONUS` | Иконки бонусов. Изначально размещаются под рандомной `WALL`, т.е. в начале уровня не видны. При контакте с `HERO` для `HERO` добавляется соответствующий бонусу параметр (увеличивается скорость и т.д.), а сама иконка исчезает. При контакте с `ENEMY` ничего не происходит, `ENEMY` просто проходит поверх. При контакте с `BLAST` исчезает |
| `EXIT` | Дверь для перехода на следующий уровень |

Анимируются:
- `HERO`
- `BOMB`
- `BLAST`
- `ENEMY`


## Герой

- В спокойном состоянии смотрит в сторону последнего направления движения (по умолчанию вправо). Применяется анимация `STAYING ⇔ SITTING`
- В состоянии движения смотрит в сторону направления движения. Применяется анимация `MOVING 1 ⇔ MOVING 2`
- Задается изначальная скорость перемещения в пикселях за один кадр. Может увеличиться при взятии `BONUS_SPEED`. После гибели сбрасывается до изначального значения
- Управляется стрелками
- Так как строго между колоннами расположить `HERO` сложно, применяется параметр `TOLERANCE`. Это допустимая величина пикселей от границ колонн, в рамках которой `HERO` автоматически выравнивается при попытке пройти между колоннами. Например, для скорости `3` подходит значение `9`
- Погибает при контакте с `HERO`, если нет бонуса `IMMORTAL`
- Погибает при контакте с `BLAST`, если нет бонуса `FIREPASS` или `IMMORTAL`


## Враги

| Имя | Описание |
| :------- | -------- |
| `BALLOON` | Средняя скорость, может поворачивать только в конце, 100 очков |
| `BEAKER` | Скорость выше `BALLOON`, двигается случайно, 200 очков |
| `LANTERN` | Скорость выше `BEAKER`, двигается туда-обратно, 400 очков |
| `FACE` | Скорость выше `LANTERN`, двигается туда-обратно, 800 очков |
| `GHOST` | Средняя скорость, двигается случайно, ходит сквозь стены, 1000 очков |
| `JELLY` | Самая низкая скорость, двигается случайно, ходит сквозь стены, 2000 очков |
| `BEAR` | Высокая скорость, двигается случайно, 4000 очков |
| `COIN` | Самая высокая скорость, двигается случайно, ходит сквозь стены, 8000 очков |

У врагов есть разные варианты текстур для разных направлений движения, а также текстура для состояния гибели


## Бонусы

| Название | Описание |
| :------- | -------- |
| `BOMB` | Позволяет одновременно размещать +1 бомбу |
| `FIRE` | Увеличивает радиус взрыва на 1 |
| `SPEED` | Делает скорость HERO равной 4px |
| `DETONATOR` | Взрывы осуществляются вручную, каждый раз взрывается самая старая бомба |
| `WALLPASS` | Позволяет проходить сквозь WALL |
| `BOMBPASS` | Позволяет проходить сквозь BOMB |
| `FIREPASS` | Дает иммунитет к взрывам |
| `IMMORTAL` | Дает временную неуязвимость к взрывам и врагам |

В оригинальной игре взрыв бонуса добавлял 8 врагов, можно сделать так же, если будет время.  
При взрыве определенных бонусов появлялись свои враги

Также в оригинальной игре есть секретные бонусы, но их пока тоже необязательно добавлять


## Бомба и взрыв

- Имеет три текстуры и анимацию `SMALL ⇔ MEDIUM ⇔ LARGE`
- Исчезает при истечении таймера, при помощи детонатора или при контакте с `BLAST`
- При исчезновении оставляет после себя `BLAST`
- `BLAST` также анимируется (увеличивается, потом уменьшается)


## Начальная отрисовка

- Рисуем информационную панель
- Размещаем `COLUMN` и `GRASS`. Используем статический холст, чтобы постоянно не обновлять эти текстуры
- Начинаем первый уровень


## Начало уровня

- Перед началом каждого уровня показываем темный экран с текстом `Уровень N`
- Спустя N секунд скрываем темный экран, рендерим на статическом холсте `WALL`
- Помещаем `WALL` рандомно, согласно константе `WALL_PROBABILITY_PCT`. Это вероятность возникновения `WALL` на соответствующей клетке в процентах
- Рисуем персонажа и врагов
- Определяем в инстансе `level`, на каких ячейках будут `BONUS` и `EXIT`. Ячейки должны быть строго на месте `WALL` и не должны повторяться
- `BONUS` размещается рандомно, доступен лишь один на уровень. Бонус для каждого уровня задается вручную, как в оригинальной игре, поскольку некоторые бонусы должны встречаться лишь раз, а некоторые — наоборот, чаще остальных
- Когда уничтожаем `WALL`, либо убираем ее со статического канваса и заменяем на `BONUS`/`EXIT`, либо рисуем `BONUS`/`EXIT` поверх на динамическом. Второй вариант лучше, не стоит лишний раз обновлять оба холста одновременно


## Окончание уровня

- Останавливаем перерисовки на какое-то время, в оригинале играла музычка
- Начинаем следующий уровень

В оригинальной игре взрыв выхода добавлял 8 врагов, можно сделать так же, если будет время


## Гибель персонажа

- Аналогично окончанию уровня, но начинаем уровень заново
- Если закончились все жизни, нужно прокинуть количество очков, редиректнуть игрока на роут окончания игры и отправить результат по API


## Звуки

Если будем добавлять звуки в конце, нужны следующие:
- Мелодия перед началом уровня
- Фоновая музыка (в оригинале не было)
- Взрыв
- Уничтожение последнего врага (сигнал, что можно на выход)
- Успешное окончание уровня при контакте с дверью
- Взятие бонуса
- Гибель персонажа


## TODO (обязательно/желательно)

- Обновление `panel` через встроенные методы класса
- Анимация персонажа (принцип берем из класса `Enemy`)
- Анимация гибели врагов
- Размещение бомбы
- Взрыв и его анимация
- Уничтожение противников
- Гибель персонажа при взрыве или контакте с противниками
- Повтор уровня после гибели
- Рендер текстуры двери
- Переход на новый уровень
- Заполнение объекта с инфой по уровням
- Редирект на страницу окончания игры
- Отправка данных на сервер


## TODO (необязательно)

- Бонусы
- Секретные бонусы
- Выход из игры на `Escape`
